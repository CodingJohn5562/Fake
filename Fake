-- REPLICATOR HUB v5.5 – FULLY FIXED & EXACTLY HOW YOU WANTED
-- Draggable ✓ | Minimize works ✓ | Replicator ON/OFF button back ✓
-- Fake Pos = 0.11s sky teleport → replicator ON → snap back (you can shoot perfectly)
-- Turn OFF = just disables replicator (no teleport)

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local root = char:WaitForChild("HumanoidRootPart")

-- GUI
local scr = Instance.new("ScreenGui")
scr.Name = "ReplicatorHubV55"
scr.ResetOnSpawn = false
scr.Parent = game.CoreGui

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 260, 0, 360)
main.Position = UDim2.new(0, 100, 0.5, -180)
main.BackgroundTransparency = 1
main.Visible = false
main.Parent = scr

-- Glow
local glow = Instance.new("ImageLabel")
glow.Size = UDim2.new(1.5,0,1.5,0)
glow.Position = UDim2.new(0.5,0,0.5,0)
glow.AnchorPoint = Vector2.new(0.5,0.5)
glow.BackgroundTransparency = 1
glow.Image = "rbxassetid://4316371720"
glow.ImageTransparency = 0.55
glow.ImageColor3 = Color3.fromRGB(0,255,255)
glow.Parent = main

-- Card
local card = Instance.new("Frame")
card.Size = UDim2.new(1,0,1,0)
card.BackgroundColor3 = Color3.fromRGB(12,12,28)
card.Parent = main
local c = Instance.new("UICorner", card) c.CornerRadius = UDim.new(0,24)
local s = Instance.new("UIStroke", card) s.Thickness = 3 s.Color = Color3.fromRGB(0,255,255) s.Transparency = 0.3

-- Header
local header = Instance.new("Frame")
header.Size = UDim2.new(1,0,0,50)
header.BackgroundColor3 = Color3.fromRGB(18,18,38)
header.Parent = card
Instance.new("UICorner", header).CornerRadius = UDim.new(0,24)

local title = Instance.new("TextLabel")
title.Text = "REPLICATOR HUB v5.5"
title.Size = UDim2.new(0.7,0,1,0)
title.Position = UDim2.new(0,16,0,0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(0,255,255)
title.TextScaled = true
title.Font = Enum.Font.GothamBlack
title.Parent = header

local close = Instance.new("TextButton")
close.Size = UDim2.new(0,38,0,38)
close.Position = UDim2.new(1,-48,0.5,-19)
close.BackgroundColor3 = Color3.fromRGB(255,50,50)
close.Text = "X"
close.TextScaled = true
close.Parent = header
Instance.new("UICorner", close).CornerRadius = UDim.new(0,14)

local mini = Instance.new("TextButton")
mini.Size = UDim2.new(0,38,0,38)
mini.Position = UDim2.new(1,-92,0.5,-19)
mini.BackgroundColor3 = Color3.fromRGB(255,170,0)
mini.Text = "−"
mini.TextScaled = true
mini.Parent = header
Instance.new("UICorner", mini).CornerRadius = UDim.new(0,14)

local content = Instance.new("Frame")
content.Size = UDim2.new(1,0,1,-50)
content.Position = UDim2.new(0,0,0,50)
content.BackgroundTransparency = 1
content.Parent = card

-- REPLICATOR ON/OFF BUTTON (back!)
local repBtn = Instance.new("TextButton")
repBtn.Size = UDim2.new(0,140,0,60)
repBtn.Position = UDim2.new(0.5,-70,0,10)
repBtn.BackgroundColor3 = Color3.fromRGB(255,50,50)
repBtn.Text = "REPLICATOR OFF"
repBtn.TextColor3 = Color3.new(1,1,1)
repBtn.TextScaled = true
repBtn.Font = Enum.Font.GothamBlack
repBtn.Parent = content
Instance.new("UICorner", repBtn).CornerRadius = UDim.new(0,20)

-- Fake Pos Label
local label = Instance.new("TextLabel")
label.Text = "INSTANT FAKE POS (0.11s)"
label.Size = UDim2.new(1,-20,0,30)
label.Position = UDim2.new(0,10,0,85)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.fromRGB(0,255,150)
label.TextScaled = true
label.Font = Enum.Font.GothamBold
label.Parent = content

-- Coord boxes
local xBox = Instance.new("TextBox")
xBox.PlaceholderText = "X" xBox.Text = "0"
xBox.Size = UDim2.new(0.3,-6,0,42)
xBox.Position = UDim2.new(0.05,0,0,125)
xBox.BackgroundColor3 = Color3.fromRGB(30,30,50)
xBox.TextColor3 = Color3.new(1,1,1)
xBox.TextScaled = true
xBox.Parent = content
Instance.new("UICorner", xBox).CornerRadius = UDim.new(0,12)

local yBox = Instance.new("TextBox")
yBox.PlaceholderText = "Y" yBox.Text = "800"
yBox.Size = UDim2.new(0.3,-6,0,42)
yBox.Position = UDim2.new(0.35,0,0,125)
yBox.BackgroundColor3 = Color3.fromRGB(30,30,50)
yBox.TextColor3 = Color3.new(1,1,1)
yBox.TextScaled = true
yBox.Parent = content
Instance.new("UICorner", yBox).CornerRadius = UDim.new(0,12)

local zBox = Instance.new("TextBox")
zBox.PlaceholderText = "Z" zBox.Text = "0"
zBox.Size = UDim2.new(0.3,-6,0,42)
zBox.Position = UDim2.new(0.65,0,0,125)
zBox.BackgroundColor3 = Color3.fromRGB(30,30,50)
zBox.TextColor3 = Color3.new(1,1,1)
zBox.TextScaled = true
zBox.Parent = content
Instance.new("UICorner", zBox).CornerRadius = UDim.new(0,12)

-- Fake Pos Toggle
local fakeBtn = Instance.new("TextButton")
fakeBtn.Size = UDim2.new(0,180,0,55)
fakeBtn.Position = UDim2.new(0.5,-90,0,185)
fakeBtn.BackgroundColor3 = Color3.fromRGB(130,50,255)
fakeBtn.Text = "FAKE POS OFF"
fakeBtn.TextColor3 = Color3.new(1,1,1)
fakeBtn.TextScaled = true
fakeBtn.Font = Enum.Font.GothamBold
fakeBtn.Parent = content
Instance.new("UICorner", fakeBtn).CornerRadius = UDim.new(0,20)

-- Variables
local fakeActive = false
local savedPos = nil
local minimized = false

-- DRAGGING (100% fixed)
local dragging = false
local dragInput, dragStart, startPos

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then
        local delta = input.Position - dragStart
        main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- MINIMIZE (fixed)
mini.MouseButton1Click:Connect(function()
    minimized = not minimized
    mini.Text = minimized and "+" or "−"
    content.Visible = not minimized
    TweenService:Create(card, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {
        Size = minimized and UDim2.new(1,0,0,50) or UDim2.new(1,0,1,0)
    }):Play()
end)

close.MouseButton1Click:Connect(function() scr:Destroy() end)

-- T KEY
UserInputService.InputBegan:Connect(function(inp, gp)
    if inp.KeyCode == Enum.KeyCode.T and not gp then
        main.Visible = not main.Visible
        if main.Visible and minimized then
            minimized = false
            mini.Text = "−"
            content.Visible = true
            card.Size = UDim2.new(1,0,1,0)
        end
    end
end)

-- REPLICATOR ON/OFF BUTTON
repBtn.MouseButton1Click:Connect(function()
    local on = repBtn.Text == "REPLICATOR OFF"
    repBtn.Text = on and "REPLICATOR ON" or "REPLICATOR OFF"
    repBtn.BackgroundColor3 = on and Color3.fromRGB(0,255,100) or Color3.fromRGB(255,50,50)
    glow.ImageColor3 = on and Color3.fromRGB(0,255,100) or Color3.fromRGB(0,255,255)
    pcall(function() setfflag("NextGenReplicatorEnabledWrite4", on and "true" or "false") end)
end)

-- INSTANT FAKE POS (0.11s method – exactly like original)
fakeBtn.MouseButton1Click:Connect(function()
    fakeActive = not fakeActive
    
    if fakeActive then
        savedPos = root.CFrame
        local x = tonumber(xBox.Text) or 0
        local y = tonumber(yBox.Text) or 800
        local z = tonumber(zBox.Text) or 0
        
        -- Teleport up for 0.11s + enable replicator
        root.CFrame = CFrame.new(x, y, z)
        task.wait(0.11)
        pcall(function() setfflag("NextGenReplicatorEnabledWrite4", "true") end)
        
        -- Snap back
        root.CFrame = savedPos
        
        fakeBtn.Text = "FAKE POS ON"
        fakeBtn.BackgroundColor3 = Color3.fromRGB(0,255,150)
        glow.ImageColor3 = Color3.fromRGB(0,255,150)
        
        -- Keep replicator on
        repBtn.Text = "REPLICATOR ON"
        repBtn.BackgroundColor3 = Color3.fromRGB(0,255,100)
        
    else
        -- Just turn replicator OFF (no teleport back needed)
        pcall(function() setfflag("NextGenReplicatorEnabledWrite4", "false") end)
        repBtn.Text = "REPLICATOR OFF"
        repBtn.BackgroundColor3 = Color3.fromRGB(255,50,50)
        glow.ImageColor3 = Color3.fromRGB(0,255,255)
        
        fakeBtn.Text = "FAKE POS OFF"
        fakeBtn.BackgroundColor3 = Color3.fromRGB(130,50,255)
    end
end)

-- Respawn
player.CharacterAdded:Connect(function(c)
    char = c
    root = c:WaitForChild("HumanoidRootPart")
    fakeActive = false
    fakeBtn.Text = "FAKE POS OFF"
    fakeBtn.BackgroundColor3 = Color3.fromRGB(130,50,255)
end)

-- Startup
main.Visible = true
TweenService:Create(main, TweenInfo.new(0.7, Enum.EasingStyle.Back), {Position = UDim2.new(0,100,0.5,-180)}):Play()

print("REPLICATOR HUB v5.5 – EVERYTHING FIXED! Drag, Minimize, 0.11s Fake Pos + Replicator Button")
